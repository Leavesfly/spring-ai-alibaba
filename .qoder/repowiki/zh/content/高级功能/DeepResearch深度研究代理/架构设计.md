# DeepResearch深度研究代理架构设计文档

<cite>
**本文档引用的文件**
- [DeepResearchApplication.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/DeepResearchApplication.java)
- [DeepResearchConfiguration.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/config/DeepResearchConfiguration.java)
- [StateGraph.java](file://spring-ai-alibaba-graph-core/src/main/java/com/alibaba/cloud/ai/graph/StateGraph.java)
- [CoordinatorNode.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/node/CoordinatorNode.java)
- [ResearcherNode.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/node/ResearcherNode.java)
- [ChatController.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/controller/ChatController.java)
- [DeepResearchProperties.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/config/DeepResearchProperties.java)
- [ReportService.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/service/ReportService.java)
- [app-application.yml](file://spring-ai-alibaba-deepresearch/dockerConfig/app-application.yml)
- [package.json](file://spring-ai-alibaba-deepresearch/ui-vue3/package.json)
</cite>

## 目录
1. [简介](#简介)
2. [项目结构概览](#项目结构概览)
3. [核心架构组件](#核心架构组件)
4. [StateGraph工作流编排](#stategraph工作流编排)
5. [多智能体协作机制](#多智能体协作机制)
6. [系统上下文图](#系统上下文图)
7. [组件交互关系](#组件交互关系)
8. [技术选型与设计决策](#技术选型与设计决策)
9. [部署拓扑](#部署拓扑)
10. [性能考虑](#性能考虑)
11. [故障排除指南](#故障排除指南)
12. [总结](#总结)

## 简介

DeepResearch深度研究代理是一个基于Spring Boot的微服务架构系统，专门设计用于处理复杂的深度研究任务。该系统采用先进的StateGraph工作流编排技术，结合多智能体协作机制，能够高效地完成信息收集、分析、整合和报告生成等复杂任务。

系统的核心特点包括：
- 基于Spring Boot的现代化微服务架构
- 利用StateGraph进行灵活的工作流编排
- 多智能体协作的分布式处理能力
- 支持实时流式响应的SSE（Server-Sent Events）通信
- 完整的前后端分离架构
- 可扩展的插件化组件设计

## 项目结构概览

DeepResearch项目采用模块化的Maven项目结构，主要包含以下核心模块：

```mermaid
graph TB
subgraph "核心模块"
DR[deepresearch<br/>主应用模块]
GC[graph-core<br/>状态图核心]
AG[agent-nacos<br/>智能体管理]
end
subgraph "自动配置模块"
AC1[autoconfigure-a2a-client<br/>A2A客户端配置]
AC2[autoconfigure-a2a-server<br/>A2A服务器配置]
AC3[autoconfigure-memory<br/>内存配置]
AC4[autoconfigure-dashscope<br/>DashScope配置]
end
subgraph "社区扩展模块"
CE1[document-parsers<br/>文档解析器]
CE2[document-readers<br/>文档阅读器]
CE3[tool-calls<br/>工具调用]
CE4[memories<br/>记忆存储]
end
DR --> GC
DR --> AG
DR --> AC1
DR --> AC2
DR --> AC3
DR --> AC4
DR --> CE1
DR --> CE2
DR --> CE3
DR --> CE4
```

**图表来源**
- [DeepResearchApplication.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/DeepResearchApplication.java#L1-L34)
- [StateGraph.java](file://spring-ai-alibaba-graph-core/src/main/java/com/alibaba/cloud/ai/graph/StateGraph.java#L1-L50)

**章节来源**
- [DeepResearchApplication.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/DeepResearchApplication.java#L1-L34)
- [package.json](file://spring-ai-alibaba-deepresearch/ui-vue3/package.json#L1-L79)

## 核心架构组件

### 控制器层（Controller Layer）

控制器层负责处理HTTP请求和WebSocket连接，是系统的入口点：

```mermaid
classDiagram
class ChatController {
-CompiledGraph compiledGraph
-GraphProcess graphProcess
-SearchBeanUtil searchBeanUtil
+chatStream(ChatRequest) Flux~ServerSentEvent~
+stopGraph(GraphId) ApiResponse~String~
+resume(FeedbackRequest) Flux~ServerSentEvent~
}
class McpController {
+handleMcpRequest() ResponseEntity
+registerMcpServer() ResponseEntity
}
class ReportController {
+generateReport() ResponseEntity
+exportReport() ResponseEntity
}
class RagDataController {
+ingestData() ResponseEntity
+queryData() ResponseEntity
}
ChatController --> GraphProcess : "使用"
ChatController --> SearchBeanUtil : "依赖"
```

**图表来源**
- [ChatController.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/controller/ChatController.java#L1-L181)

### 服务层（Service Layer）

服务层包含各种业务逻辑服务，支持多智能体协作：

```mermaid
classDiagram
class ReportService {
<<interface>>
+saveReport(threadId, report)
+getReport(threadId) String
+existsReport(threadId) boolean
+deleteReport(threadId)
}
class SessionContextService {
+getRecentReports(sessionId) SessionHistory[]
+updateSessionContext(context)
+getSessionContext(sessionId)
}
class SearchFilterService {
+filterSearchResults(results) List
+applyFilters(filters) FilterCriteria
}
class SmartAgentDispatcherService {
+dispatchAgent(task) AgentSelectionResult
+selectSmartAgent(query) AgentSelectionResult
}
class RagNodeService {
+createUserFileRagNode() Node
+createProfessionalKbRagNode() Node
}
ReportService <|-- ReportRedisService : "实现"
ReportService <|-- ReportMemoryService : "实现"
```

**图表来源**
- [ReportService.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/service/ReportService.java#L1-L55)

### 节点层（Node Layer）

节点层是StateGraph的核心组件，每个节点代表一个特定的功能单元：

```mermaid
classDiagram
class NodeAction {
<<interface>>
+apply(OverAllState) Map~String,Object~
}
class CoordinatorNode {
-ChatClient coordinatorAgent
-SessionContextService sessionContextService
+apply(OverAllState) Map~String,Object~
}
class ResearcherNode {
-ChatClient researchAgent
-String executorNodeId
-ReflectionProcessor reflectionProcessor
-McpProviderFactory mcpFactory
+apply(OverAllState) Map~String,Object~
}
class ReporterNode {
-ChatClient reporterAgent
-ReportService reportService
-SessionContextService sessionContextService
+apply(OverAllState) Map~String,Object~
}
class ParallelExecutorNode {
-DeepResearchProperties properties
+apply(OverAllState) Map~String,Object~
}
NodeAction <|.. CoordinatorNode : "实现"
NodeAction <|.. ResearcherNode : "实现"
NodeAction <|.. ReporterNode : "实现"
NodeAction <|.. ParallelExecutorNode : "实现"
```

**图表来源**
- [CoordinatorNode.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/node/CoordinatorNode.java#L1-L111)
- [ResearcherNode.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/node/ResearcherNode.java#L1-L287)

**章节来源**
- [CoordinatorNode.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/node/CoordinatorNode.java#L1-L111)
- [ResearcherNode.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/node/ResearcherNode.java#L1-L287)
- [ReportService.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/service/ReportService.java#L1-L55)

## StateGraph工作流编排

### StateGraph核心概念

StateGraph是DeepResearch系统的核心工作流编排引擎，它基于状态机模式实现了灵活的任务调度和状态管理：

```mermaid
flowchart TD
START([开始节点 __START__]) --> COORDINATOR[协调器节点]
COORDINATOR --> REWRITE_QUERY{重写查询?}
REWRITE_QUERY --> |是| MULTI_QUERY[多查询重写]
REWRITE_QUERY --> |否| BACKGROUND[背景调查]
MULTI_QUERY --> BACKGROUND
BACKGROUND --> SEARCH_DECISION{需要搜索?}
SEARCH_DECISION --> |是| SEARCH_NODE[搜索节点]
SEARCH_DECISION --> |否| PLANNER[规划器节点]
SEARCH_NODE --> PLANNER
PLANNER --> INFORMATION[信息收集]
INFORMATION --> FEEDBACK{需要反馈?}
FEEDBACK --> |是| HUMAN_FEEDBACK[人工反馈]
FEEDBACK --> |否| RESEARCH_TEAM[研究团队]
HUMAN_FEEDBACK --> PLANNER
RESEARCH_TEAM --> PARALLEL_EXECUTOR[并行执行器]
PARALLEL_EXECUTOR --> REPORTER[报告生成器]
REPORTER --> END([结束节点 __END__])
subgraph "并行节点"
RESEARCHER1[研究员1]
RESEARCHER2[研究员2]
CODER1[编码器1]
CODER2[编码器2]
end
PARALLEL_EXECUTOR --> RESEARCHER1
PARALLEL_EXECUTOR --> RESEARCHER2
PARALLEL_EXECUTOR --> CODER1
PARALLEL_EXECUTOR --> CODER2
```

**图表来源**
- [DeepResearchConfiguration.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/config/DeepResearchConfiguration.java#L200-L309)

### 状态管理机制

StateGraph通过键策略（KeyStrategy）来管理状态数据的存储和检索：

```mermaid
sequenceDiagram
participant Client as 客户端
participant Controller as 控制器
participant Graph as StateGraph
participant Node as 节点处理器
participant State as 状态存储
Client->>Controller : 发送聊天请求
Controller->>Graph : 编译图并初始化
Graph->>State : 创建初始状态
State-->>Graph : 返回状态实例
loop 每个节点执行
Graph->>Node : 执行节点逻辑
Node->>State : 更新状态数据
State-->>Node : 确认更新
Node-->>Graph : 返回执行结果
Graph->>Graph : 决定下一个节点
end
Graph-->>Controller : 返回最终状态
Controller-->>Client : 流式返回结果
```

**图表来源**
- [ChatController.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/controller/ChatController.java#L80-L150)
- [StateGraph.java](file://spring-ai-alibaba-graph-core/src/main/java/com/alibaba/cloud/ai/graph/StateGraph.java#L427-L459)

**章节来源**
- [DeepResearchConfiguration.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/config/DeepResearchConfiguration.java#L200-L309)
- [ChatController.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/controller/ChatController.java#L80-L150)

## 多智能体协作机制

### 智能体类型与职责

DeepResearch系统支持多种类型的智能体，每种智能体都有特定的职责和能力：

```mermaid
graph TB
subgraph "智能体协作架构"
COORD[协调器智能体<br/>负责任务分配和流程控制]
subgraph "研究智能体组"
RESEARCHER1[研究员1<br/>专业领域研究]
RESEARCHER2[研究员2<br/>交叉学科研究]
RESEARCHER3[研究员3<br/>数据分析专家]
end
subgraph "编码智能体组"
CODER1[编码器1<br/>Python编程]
CODER2[编码器2<br/>数据分析]
CODER3[编码器3<br/>可视化开发]
end
subgraph "专用智能体"
PLANNER[规划器<br/>任务分解和计划制定]
REPORTER[报告员<br/>综合报告生成]
HUMAN[人工反馈<br/>人类专家介入]
end
COORD --> RESEARCHER1
COORD --> RESEARCHER2
COORD --> RESEARCHER3
COORD --> CODER1
COORD --> CODER2
COORD --> CODER3
COORD --> PLANNER
COORD --> REPORTER
COORD --> HUMAN
RESEARCHER1 --> PLANNER
RESEARCHER2 --> PLANNER
RESEARCHER3 --> PLANNER
CODER1 --> REPORTER
CODER2 --> REPORTER
CODER3 --> REPORTER
PLANNER --> REPORTER
HUMAN --> PLANNER
end
```

### 智能体选择与调度

系统通过SmartAgentDispatcherService实现智能体的选择和调度：

```mermaid
sequenceDiagram
participant Request as 请求
participant Dispatcher as 分发器
participant Classifier as 分类器
participant Selector as 选择器
participant Agent as 智能体
Request->>Dispatcher : 提交研究任务
Dispatcher->>Classifier : 分析任务类型
Classifier->>Classifier : 识别任务特征
Classifier-->>Dispatcher : 返回分类结果
Dispatcher->>Selector : 选择最适合的智能体
Selector->>Selector : 评估智能体能力
Selector->>Selector : 计算匹配度
Selector-->>Dispatcher : 返回最佳选择
Dispatcher->>Agent : 分配具体任务
Agent->>Agent : 执行研究任务
Agent-->>Dispatcher : 返回执行结果
Dispatcher-->>Request : 汇总所有结果
```

**图表来源**
- [DeepResearchConfiguration.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/config/DeepResearchConfiguration.java#L270-L309)

### 并行执行机制

系统支持多个智能体并行执行相同或相关任务：

```mermaid
flowchart LR
subgraph "并行执行器"
PE[并行执行器]
subgraph "并行节点池"
R1[研究员1]
R2[研究员2]
R3[研究员3]
C1[编码器1]
C2[编码器2]
end
PE --> R1
PE --> R2
PE --> R3
PE --> C1
PE --> C2
R1 -.-> TEAM[研究团队]
R2 -.-> TEAM
R3 -.-> TEAM
C1 -.-> TEAM
C2 -.-> TEAM
end
```

**图表来源**
- [DeepResearchConfiguration.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/config/DeepResearchConfiguration.java#L270-L309)

**章节来源**
- [DeepResearchConfiguration.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/config/DeepResearchConfiguration.java#L270-L309)
- [ResearcherNode.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/node/ResearcherNode.java#L80-L150)

## 系统上下文图

### 整体系统架构

```mermaid
graph TB
subgraph "外部系统"
WEB[Web浏览器]
MOBILE[移动应用]
API[第三方API]
end
subgraph "前端层"
VUE[Vue3前端应用]
COMPONENTS[UI组件库]
STORE[状态管理]
end
subgraph "网关层"
GATEWAY[Spring Cloud Gateway]
AUTH[认证授权]
RATE_LIMIT[限流熔断]
end
subgraph "应用层"
DR_APP[DeepResearch应用]
CONTROLLER[控制器层]
SERVICE[服务层]
NODE[节点层]
end
subgraph "基础设施层"
REDIS[Redis缓存]
ES[Elasticsearch]
MYSQL[MySQL数据库]
MINIO[对象存储]
end
subgraph "AI服务层"
DASHSCOPE[DashScope模型]
MCP[MCP协议]
TOOL[工具调用]
end
WEB --> VUE
MOBILE --> VUE
VUE --> COMPONENTS
VUE --> STORE
VUE --> GATEWAY
GATEWAY --> AUTH
GATEWAY --> RATE_LIMIT
GATEWAY --> DR_APP
DR_APP --> CONTROLLER
DR_APP --> SERVICE
DR_APP --> NODE
CONTROLLER --> REDIS
CONTROLLER --> ES
SERVICE --> MYSQL
NODE --> DASHSCOPE
NODE --> MCP
NODE --> TOOL
API --> DASHSCOPE
API --> TOOL
```

**图表来源**
- [app-application.yml](file://spring-ai-alibaba-deepresearch/dockerConfig/app-application.yml#L1-L31)
- [package.json](file://spring-ai-alibaba-deepresearch/ui-vue3/package.json#L1-L79)

### 数据流架构

```mermaid
sequenceDiagram
participant User as 用户
participant Frontend as 前端界面
participant Backend as 后端服务
participant StateGraph as 状态图
participant Agents as 智能体集群
participant Storage as 存储层
User->>Frontend : 输入研究请求
Frontend->>Backend : HTTP/SSE请求
Backend->>StateGraph : 初始化工作流
StateGraph->>Storage : 保存会话状态
loop 多智能体协作
StateGraph->>Agents : 分发子任务
Agents->>Agents : 执行具体任务
Agents->>StateGraph : 返回中间结果
StateGraph->>Storage : 更新状态数据
end
StateGraph->>Agents : 生成最终报告
Agents->>Backend : 返回完整结果
Backend->>Frontend : 流式返回响应
Frontend->>User : 显示研究报告
```

**图表来源**
- [ChatController.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/controller/ChatController.java#L80-L150)

## 组件交互关系

### 核心组件依赖图

```mermaid
graph TD
subgraph "配置层"
CONFIG[DeepResearchConfiguration]
PROPS[DeepResearchProperties]
AGENT_CONFIG[AgentModelsConfiguration]
end
subgraph "控制器层"
CHAT_CTRL[ChatController]
MCP_CTRL[McpController]
REPORT_CTRL[ReportController]
end
subgraph "服务层"
SESSION_SERVICE[SessionContextService]
REPORT_SERVICE[ReportService]
SEARCH_SERVICE[SearchInfoService]
SMART_DISPATCHER[SmartAgentDispatcherService]
end
subgraph "节点层"
COORD_NODE[CoordinatorNode]
RESEARCH_NODE[ResearcherNode]
REPORT_NODE[ReporterNode]
PARALLEL_NODE[ParallelExecutorNode]
end
subgraph "工具层"
STATE_UTIL[StateUtil]
REFLECTION_PROC[ReflectionProcessor]
MCP_FACTORY[McpProviderFactory]
end
CONFIG --> CHAT_CTRL
CONFIG --> COORD_NODE
CONFIG --> RESEARCH_NODE
CONFIG --> REPORT_NODE
PROPS --> CONFIG
AGENT_CONFIG --> CONFIG
CHAT_CTRL --> SESSION_SERVICE
CHAT_CTRL --> REPORT_SERVICE
MCP_CTRL --> MCP_FACTORY
COORD_NODE --> SESSION_SERVICE
COORD_NODE --> STATE_UTIL
RESEARCH_NODE --> SEARCH_SERVICE
RESEARCH_NODE --> SMART_DISPATCHER
RESEARCH_NODE --> REFLECTION_PROC
REPORT_NODE --> REPORT_SERVICE
PARALLEL_NODE --> RESEARCH_NODE
PARALLEL_NODE --> REPORT_NODE
```

**图表来源**
- [DeepResearchConfiguration.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/config/DeepResearchConfiguration.java#L1-L309)
- [ChatController.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/controller/ChatController.java#L1-L181)

### 状态流转图

```mermaid
stateDiagram-v2
[*] --> 初始化
初始化 --> 协调阶段 : 接收用户请求
协调阶段 --> 查询重写 : 需要优化查询
协调阶段 --> 背景调查 : 直接进入研究
查询重写 --> 背景调查 : 生成优化查询
背景调查 --> 搜索决策 : 收集基础信息
搜索决策 --> 搜索执行 : 需要网络搜索
搜索决策 --> 规划阶段 : 仅需内部知识
搜索执行 --> 规划阶段 : 获取搜索结果
规划阶段 --> 信息收集 : 制定研究计划
信息收集 --> 人工反馈 : 需要专家意见
信息收集 --> 研究团队 : 自动执行
人工反馈 --> 规划阶段 : 修改研究计划
研究团队 --> 并行执行 : 分配具体任务
并行执行 --> 报告生成 : 所有任务完成
报告生成 --> [*] : 输出最终报告
```

**图表来源**
- [DeepResearchConfiguration.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/config/DeepResearchConfiguration.java#L200-L309)

**章节来源**
- [DeepResearchConfiguration.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/config/DeepResearchConfiguration.java#L1-L309)
- [ChatController.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/controller/ChatController.java#L1-L181)

## 技术选型与设计决策

### 核心技术栈

1. **Spring Boot生态系统**
   - 基础框架：Spring Boot 3.x
   - 依赖注入：Spring Framework
   - Web层：Spring WebFlux（响应式编程）
   - 配置管理：Spring Boot Starter

2. **状态图编排引擎**
   - StateGraph：自研工作流编排框架
   - 支持异步执行和流式处理
   - 基于状态机的设计模式

3. **实时通信**
   - SSE（Server-Sent Events）：流式响应
   - WebSocket：双向通信
   - Reactor：响应式编程模型

4. **前端技术栈**
   - Vue3：现代JavaScript框架
   - Ant Design Vue：UI组件库
   - Pinia：状态管理
   - TypeScript：类型安全

### 关键设计决策

1. **StateGraph vs 传统工作流引擎**
   - 优势：轻量级、可扩展、易于调试
   - 特性：支持条件分支、并行执行、状态持久化
   - 应用场景：复杂的多智能体协作任务

2. **响应式编程模型**
   - 优势：非阻塞I/O、高并发处理
   - 实现：Spring WebFlux + Reactor
   - 场景：实时流式响应和大量并发请求

3. **微服务架构**
   - 优势：模块化、可独立部署、易于维护
   - 实现：Spring Cloud生态
   - 场景：大型分布式系统

4. **智能体协作机制**
   - 优势：专业化分工、并行处理、质量保证
   - 实现：多AgentDispatcher + 智能选择算法
   - 场景：复杂研究任务的分解和执行

**章节来源**
- [DeepResearchProperties.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/config/DeepResearchProperties.java#L1-L87)
- [package.json](file://spring-ai-alibaba-deepresearch/ui-vue3/package.json#L1-L79)

## 部署拓扑

### 容器化部署架构

```mermaid
graph TB
subgraph "负载均衡层"
LB[Nginx负载均衡器]
end
subgraph "应用服务层"
APP1[DeepResearch应用1]
APP2[DeepResearch应用2]
APP3[DeepResearch应用N]
end
subgraph "中间件层"
REDIS[Redis集群]
ES[Elasticsearch集群]
MYSQL[MySQL主从]
MINIO[MinIO存储]
end
subgraph "监控层"
PROM[Prometheus]
GRAFANA[Grafana]
LOGSTASH[Logstash]
end
subgraph "外部服务"
DASHSCOPE[阿里云DashScope]
MCP_SERVER[MCP服务器]
end
LB --> APP1
LB --> APP2
LB --> APP3
APP1 --> REDIS
APP1 --> ES
APP1 --> MYSQL
APP1 --> MINIO
APP2 --> REDIS
APP2 --> ES
APP2 --> MYSQL
APP2 --> MINIO
APP3 --> REDIS
APP3 --> ES
APP3 --> MYSQL
APP3 --> MINIO
APP1 --> DASHSCOPE
APP1 --> MCP_SERVER
APP2 --> DASHSCOPE
APP2 --> MCP_SERVER
APP3 --> DASHSCOPE
APP3 --> MCP_SERVER
PROM --> APP1
PROM --> APP2
PROM --> APP3
GRAFANA --> PROM
LOGSTASH --> APP1
LOGSTASH --> APP2
LOGSTASH --> APP3
```

**图表来源**
- [app-application.yml](file://spring-ai-alibaba-deepresearch/dockerConfig/app-application.yml#L1-L31)

### Docker Compose配置

系统提供了完整的Docker Compose配置，支持一键部署：

```yaml
version: '3.8'
services:
  deep-research-app:
    build: .
    ports:
      - "8080:8080"
    depends_on:
      - deep-research-redis
      - deep-research-es
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - SPRING_DATA_REDIS_HOST=deep-research-redis
      - SPRING_AI_ALIBABA_DEEPRESEARCH_RAG_ELASTICSEARCH_URIS=http://deep-research-es:9200
  
  deep-research-redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
  
  deep-research-es:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.11.0
    ports:
      - "9200:9200"
    environment:
      - discovery.type=single-node
      - xpack.security.enabled=false
```

**章节来源**
- [app-application.yml](file://spring-ai-alibaba-deepresearch/dockerConfig/app-application.yml#L1-L31)

## 性能考虑

### 并发处理能力

1. **响应式编程模型**
   - 支持数千个并发连接
   - 非阻塞I/O操作
   - 内存高效利用

2. **智能体并行执行**
   - 动态调整并行数量
   - 资源限制和保护
   - 负载均衡策略

3. **缓存机制**
   - Redis缓存热点数据
   - Elasticsearch加速搜索
   - 内存缓存常用配置

### 性能优化策略

1. **状态序列化优化**
   - Jackson序列化器
   - 自定义状态序列化器
   - 增量状态更新

2. **流式处理**
   - SSE流式响应
   - 分块传输编码
   - 实时进度反馈

3. **资源管理**
   - 连接池配置
   - 内存使用监控
   - JVM参数调优

## 故障排除指南

### 常见问题诊断

1. **StateGraph执行异常**
   ```java
   // 检查节点配置
   GraphStateException exception = new GraphStateException("节点配置错误");
   exception.printStackTrace();
   
   // 检查状态序列化
   DeepResearchStateSerializer serializer = new DeepResearchStateSerializer();
   OverAllState state = serializer.deserialize(serializedState);
   ```

2. **智能体调度失败**
   ```java
   // 检查智能体可用性
   SmartAgentDispatcherService dispatcher = new SmartAgentDispatcherService();
   AgentSelectionResult result = dispatcher.dispatchAgent(task);
   
   if (result.getSelectedAgent() == null) {
       logger.error("智能体调度失败: {}", result.getErrorReason());
   }
   ```

3. **并行执行超时**
   ```java
   // 配置超时时间
   DeepResearchProperties properties = new DeepResearchProperties();
   properties.setMaxIterations(100); // 增加最大迭代次数
   
   // 监控并行节点状态
   ParallelExecutorNode node = new ParallelExecutorNode(properties);
   Map<String, Object> result = node.apply(state);
   ```

### 监控指标

1. **系统健康检查**
   - CPU使用率
   - 内存占用
   - 网络连接数
   - 数据库连接池状态

2. **应用性能指标**
   - 请求响应时间
   - 并发用户数
   - StateGraph执行时间
   - 智能体调度成功率

3. **业务指标**
   - 研究任务完成率
   - 报告生成时间
   - 用户满意度评分
   - 系统可用性

**章节来源**
- [DeepResearchConfiguration.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/config/DeepResearchConfiguration.java#L100-L150)

## 总结

DeepResearch深度研究代理系统是一个高度集成的微服务架构解决方案，具有以下核心优势：

### 技术架构优势

1. **StateGraph工作流编排**
   - 灵活的状态管理和流转控制
   - 支持复杂的多智能体协作
   - 易于扩展和维护的模块化设计

2. **响应式编程模型**
   - 高并发处理能力
   - 实时流式响应
   - 资源高效利用

3. **智能体协作机制**
   - 专业化分工和并行处理
   - 智能的任务分配和调度
   - 质量保证和反思机制

### 系统特性

1. **可扩展性**
   - 模块化设计支持功能扩展
   - 插件化架构便于集成新组件
   - 容器化部署简化运维

2. **可靠性**
   - 完善的错误处理和恢复机制
   - 状态持久化确保数据安全
   - 监控和告警体系保障系统稳定

3. **易用性**
   - RESTful API接口
   - 实时流式响应
   - 完整的前后端分离架构

### 应用场景

DeepResearch系统特别适用于以下场景：
- 复杂的研究项目管理
- 多学科交叉的知识整合
- 高质量报告的自动化生成
- 大规模数据的智能分析

该系统通过先进的技术架构和设计理念，为深度研究任务提供了强大而灵活的解决方案，能够有效提升研究效率和质量，是现代AI应用开发的优秀实践案例。