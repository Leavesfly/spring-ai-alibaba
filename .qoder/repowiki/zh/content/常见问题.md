# 常见问题

<cite>
**本文档引用的文件**
- [README.md](file://README.md)
- [DashScopeChatAutoConfiguration.java](file://auto-configurations/spring-ai-alibaba-autoconfigure-dashscope/src/main/java/com/alibaba/cloud/ai/autoconfigure/dashscope/DashScopeChatAutoConfiguration.java)
- [ChatMemoryAutoConfiguration.java](file://auto-configurations/spring-ai-alibaba-autoconfigure-memory/src/main/java/com/alibaba/cloud/ai/autoconfigure/memory/ChatMemoryAutoConfiguration.java)
- [OpenSearchVectorStoreAutoConfiguration.java](file://community/vector-stores/spring-ai-alibaba-starter-opensearch-store/src/main/java/com/alibaba/cloud/ai/vectorstore/opensearch/OpenSearchVectorStoreAutoConfiguration.java)
- [TikaDocumentParser.java](file://community/document-parsers/spring-ai-alibaba-starter-document-parser-tika/src/main/java/com/alibaba/cloud/ai/parser/tika/TikaDocumentParser.java)
- [ToolCallingSearchService.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/service/multiagent/ToolCallingSearchService.java)
- [pom.xml](file://spring-ai-alibaba-spring-boot-starters/spring-ai-alibaba-starter-dashscope/pom.xml)
- [spring-ai-alibaba-bom/pom.xml](file://spring-ai-alibaba-bom/pom.xml)
- [CONTRIBUTING-zh.md](file://CONTRIBUTING-zh.md)
- [spring-ai-alibaba-studio-server-core/src/main/java/com/alibaba/cloud/ai/studio/core/workflow/processor/AbstractExecuteProcessor.java](file://spring-ai-alibaba-studio/spring-ai-alibaba-studio-server/spring-ai-alibaba-studio-server-core/src/main/java/com/alibaba/cloud/ai/studio/core/workflow/processor/AbstractExecuteProcessor.java)
- [BizException.java](file://spring-ai-alibaba-studio/spring-ai-alibaba-studio-server/spring-ai-alibaba-studio-server-runtime/src/main/java/com/alibaba/cloud/ai/studio/runtime/exception/BizException.java)
</cite>

## 目录
1. [安装问题](#安装问题)
2. [配置问题](#配置问题)
3. [性能问题](#性能问题)
4. [故障排除](#故障排除)
5. [已知限制与变通方法](#已知限制与变通方法)

## 安装问题

### 如何开始使用spring-ai-alibaba框架？
要快速开始使用spring-ai-alibaba，需要在Java项目中添加'spring-ai-alibaba-starter-dashscope'依赖。首先通过BOM（物料清单）管理版本，然后添加所需的启动器依赖。

**解决方案：**
```xml
<dependencyManagement>
  <dependencies>
    <dependency>
      <groupId>com.alibaba.cloud.ai</groupId>
      <artifactId>spring-ai-alibaba-bom</artifactId>
      <version>1.0.0.3</version>
      <type>pom</type>
      <scope>import</scope>
    </dependency>
  </dependencies>
</dependencyManagement>

<dependencies>
  <dependency>
    <groupId>com.alibaba.cloud.ai</groupId>
    <artifactId>spring-ai-alibaba-starter-dashscope</artifactId>
  </dependency>
</dependencies>
```

**诊断技巧：**
- 确保JDK版本为17或更高版本
- 检查Maven仓库配置是否正确
- 验证网络连接以确保能下载依赖

[更多入门信息](https://java2ai.com/docs/1.0.0.3/get-started/chatbot)

**Section sources**
- [README.md](file://README.md#L1-L143)
- [pom.xml](file://spring-ai-alibaba-spring-boot-starters/spring-ai-alibaba-starter-dashscope/pom.xml#L0-L58)
- [spring-ai-alibaba-bom/pom.xml](file://spring-ai-alibaba-bom/pom.xml#L0-L799)

### 如何解决依赖冲突问题？
当项目中存在其他Spring AI相关依赖时，可能会出现版本冲突。

**解决方案：**
1. 使用spring-ai-alibaba-bom统一管理所有相关依赖的版本
2. 确保在`dependencyManagement`部分正确导入BOM
3. 如果仍然存在问题，请检查是否配置了正确的Maven仓库

**有用的命令：**
```bash
# 查看依赖树
mvn dependency:tree

# 清理并重新构建
mvn clean install -U
```

**诊断技巧：**
- 检查是否有重复的Spring AI依赖
- 确认BOM版本是否最新
- 验证本地Maven仓库缓存

**Section sources**
- [spring-ai-alibaba-bom/pom.xml](file://spring-ai-alibaba-bom/pom.xml#L0-L799)

## 配置问题

### 如何配置DashScope聊天模型？
DashScope聊天模型的自动配置由`DashScopeChatAutoConfiguration`类处理，该类基于条件注解进行配置。

**解决方案：**
确保在application.properties或application.yml中正确配置以下属性：
```properties
# 启用DashScope聊天模型
spring.ai.model.chat=dashscope
# DashScope API密钥
dashscope.api-key=your-api-key
# 可选：自定义基础URL
dashscope.base-url=https://api.dashscope.cn
```

**调试步骤：**
1. 检查API密钥是否正确
2. 验证网络连接是否正常
3. 确认配置属性前缀是否正确

**Section sources**
- [DashScopeChatAutoConfiguration.java](file://auto-configurations/spring-ai-alibaba-autoconfigure-dashscope/src/main/java/com/alibaba/cloud/ai/autoconfigure/dashscope/DashScopeChatAutoConfiguration.java#L0-L142)

### 如何配置会话记忆功能？
会话记忆功能通过`ChatMemoryAutoConfiguration`类进行自动配置，支持多种存储后端。

**解决方案：**
根据使用的存储类型选择相应的启动器：
- Redis: `spring-ai-alibaba-starter-memory-redis`
- JDBC数据库: `spring-ai-alibaba-starter-memory-jdbc`
- MongoDB: `spring-ai-alibaba-starter-memory-mongodb`

基本配置示例：
```properties
# 启用内存聊天记忆
spring.ai.memory.enabled=true
# 设置消息窗口大小
spring.ai.memory.message-window.size=10
```

**诊断技巧：**
- 检查所选存储服务是否运行正常
- 验证连接配置是否正确
- 确认相应的启动器依赖已添加

**Section sources**
- [ChatMemoryAutoConfiguration.java](file://auto-configurations/spring-ai-alibaba-autoconfigure-memory/src/main/java/com/alibaba/cloud/ai/autoconfigure/memory/ChatMemoryAutoConfiguration.java#L0-L47)

### 如何配置向量存储？
向量存储通过特定的自动配置类进行设置，如OpenSearch向量存储。

**解决方案：**
1. 添加相应的启动器依赖
2. 在配置文件中启用并配置向量存储

配置示例：
```properties
# 启用OpenSearch向量存储
spring.ai.alibaba.vectorstore.opensearch.enabled=true
# OpenSearch连接配置
spring.ai.alibaba.vectorstore.opensearch.host=localhost
spring.ai.alibaba.vectorstore.opensearch.port=9200
```

**调试步骤：**
1. 确认OpenSearch服务正在运行
2. 验证网络连接和认证信息
3. 检查索引是否存在且结构正确

**Section sources**
- [OpenSearchVectorStoreAutoConfiguration.java](file://community/vector-stores/spring-ai-alibaba-starter-opensearch-store/src/main/java/com/alibaba/cloud/ai/vectorstore/opensearch/OpenSearchVectorStoreAutoConfiguration.java#L0-L76)

## 性能问题

### 如何优化文档解析性能？
文档解析性能可以通过选择合适的解析器和配置来优化。

**解决方案：**
1. 对于通用格式，使用Tika文档解析器
2. 对于特定格式，使用专用解析器（如PDFBox用于PDF）

配置建议：
```properties
# 调整批处理策略
spring.ai.embedding.batching.strategy=token-count
spring.ai.embedding.batching.max-tokens=8192
```

**诊断技巧：**
- 监控内存使用情况
- 分析大文件处理时间
- 考虑异步处理大型文档

**Section sources**
- [TikaDocumentParser.java](file://community/document-parsers/spring-ai-alibaba-starter-document-parser-tika/src/main/java/com/alibaba/cloud/ai/parser/tika/TikaDocumentParser.java#L0-L147)

### 如何提高工具调用效率？
工具调用效率可以通过合理配置和选择适当的工具来提升。

**解决方案：**
1. 使用缓存减少重复调用
2. 并行执行独立的工具调用
3. 优化工具调用顺序

实现示例：
```java
@Service
@ConditionalOnProperty(prefix = SmartAgentProperties.PREFIX, name = "enabled", havingValue = "true")
public class ToolCallingSearchService {
    // 注入各种搜索服务
    private final SearchService openAlexService;
    private final SearchService wikipediaService;
    // ...
}
```

**调试步骤：**
1. 监控每个工具调用的响应时间
2. 识别瓶颈工具
3. 考虑实现超时机制

**Section sources**
- [ToolCallingSearchService.java](file://spring-ai-alibaba-deepresearch/src/main/java/com/alibaba/cloud/ai/example/deepresearch/service/multiagent/ToolCallingSearchService.java#L0-L146)

## 故障排除

### 如何处理异常和错误？
框架提供了完善的异常处理机制，包括业务异常和系统异常。

**解决方案：**
1. 使用`BizException`处理业务逻辑错误
2. 实现全局异常处理器
3. 配置适当的错误日志记录

异常处理示例：
```java
public class BizException extends RuntimeException {
    private Error error;
    
    public BizException(Error error) {
        super(error.getMessage());
        this.error = error;
    }
    
    public BizException(Error error, Throwable cause) {
        super(error.getMessage(), cause);
        this.error = error;
    }
}
```

**诊断技巧：**
- 检查日志中的完整堆栈跟踪
- 验证错误码和消息是否清晰
- 确认异常是否被正确捕获和处理

**Section sources**
- [BizException.java](file://spring-ai-alibaba-studio/spring-ai-alibaba-studio-server/spring-ai-alibaba-studio-server-runtime/src/main/java/com/alibaba/cloud/ai/studio/runtime/exception/BizException.java#L48-L66)

### 如何调试工作流执行问题？
工作流执行问题可以通过内置的异常处理机制进行调试。

**解决方案：**
1. 启用详细的日志记录
2. 使用可视化工具监控工作流状态
3. 配置异常处理策略

异常处理配置：
```json
{
  "tryCatch": {
    "strategy": "failBranch",
    "defaultValue": {}
  }
}
```

**调试步骤：**
1. 检查节点执行状态
2. 验证输入输出数据
3. 确认依赖关系是否正确

**Section sources**
- [AbstractExecuteProcessor.java](file://spring-ai-alibaba-studio/spring-ai-alibaba-studio-server/spring-ai-alibaba-studio-server-core/src/main/java/com/alibaba/cloud/ai/studio/core/workflow/processor/AbstractExecuteProcessor.java#L291-L323)

## 已知限制与变通方法

### 当前框架有哪些已知限制？
spring-ai-alibaba框架目前存在一些已知限制：

**已知限制：**
1. **JDK版本要求**：需要JDK 17或更高版本
2. **特定服务依赖**：某些功能依赖阿里云特定服务
3. **实时性限制**：大规模数据处理可能存在延迟

**变通方法：**
- 对于JDK版本限制，确保开发环境满足要求
- 对于云服务依赖，考虑使用模拟器进行本地开发测试
- 对于性能问题，实施分批处理和缓存策略

**管理用户期望：**
- 明确告知用户框架的适用场景
- 提供替代方案建议
- 定期更新文档反映最新功能和限制

**Section sources**
- [README.md](file://README.md#L1-L143)
- [CONTRIBUTING-zh.md](file://CONTRIBUTING-zh.md#L4-L36)